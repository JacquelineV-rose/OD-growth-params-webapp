<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>OD Growth Curve Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
</head>
<body>
    <h1>OD Growth Curve Analyzer</h1>

    <form method="POST" enctype="multipart/form-data" class="upload-form">
        <label for="csvfile">Upload CSV (Tab-separated, raw data from Tecan):</label><br />
        <input type="file" id="csvfile" name="csvfile" accept=".csv,.tsv,.txt" required />
        <button type="submit">Analyze</button>
    </form>


    
    {% if error %}
        <p class="error">{{ error }}</p>
    {% endif %}



    {% if plot_image %}
    <div class="results">
        <h2>Growth Curve Plot</h2>
        <img src="{{ plot_image }}" alt="Growth Curve Plot" />
    </div>
    {% endif %}
    {% if growth_params %}
    <div class="metrics">
        <h2>Growth Parameters</h2>
        <table class="results-table">
            <thead>
                <tr>
                    <th>Well</th>
                    <th>Growth Rate</th>
                    <th>Lag Time (Tau)</th>
                    <th>Saturation OD</th>
                </tr>
            </thead>
            <tbody>
               {% for row in growth_params %}
                <tr>
                    <td>{{ row['Well'] }}</td>
                    <td>{{ "%.3f"|format(row['GrowthRates']) if row['GrowthRates'] is not none else 'N/A' }}</td>
                    <td>{{ "%.2f"|format(row['tau_values']) if row['tau_values'] is not none else 'N/A' }}</td>
                    <td>{{ "%.3f"|format(row['saturate_values']) if row['saturate_values'] is not none else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <br />
        <a href="{{ url_for('download_file', filename=results_file) }}" class="download-link">Download Results TSV</a>

     
        <div class="interactive-dash" style="margin-top: 40px;">
            <h2>Interactive Visualization</h2>
            <iframe src="{{ url_for('dash_embed') }}" width="100%" height="600" frameborder="0" style="border:1px solid #ccc;"></iframe>
        </div>
    </div>
    {% endif %}
</body>
</html>
